import feedparser
import feedsearch
import toml
from datetime import datetime
from datetime import datetime, timedelta

def fetch_rss_link(links) -> list[str]:
    """Locate the RSS or ATOM feed based on base url"""
    for link in links:
        feeds: list[str] = feedsearch.search(link)
        urls: list[str] = [f.url for f in feeds]
        return urls

def fetch_rss_data(urls)-> None:
    """Collect recent articles found on RSS or ATOM link"""
    # Get current year and current month
    current_year: int = datetime.now().year
    current_month: int = datetime.now().month

    # Encode list of Feed/ATOM URLs
    urls_str: str = ','.join(urls)
    urls_str.encode(encoding ='UTF-8')

    # Locate the article details by current month and current year
    feed = feedparser.parse(urls_str)
    print("Feed Title:", feed.feed.title)
    for entry in feed.entries:
        date = entry.published_parsed
        if date.tm_year == current_year and date.tm_mon == current_month:
            print("Entry Title:", entry.title)
            print("Entry Author:", entry.author)
            print("Entry Link:", entry.link)
            print("Entry Published Date:", entry.published)
            print("Entry Summary:", entry.summary)
            print("\n")

def main():
    
    with open('config.toml', 'r') as f:
        config = toml.load(f)

    links = config['websites']['feeds']
    print(links)

# Run functions
    for link in links:
        urls = fetch_rss_link(links)
        fetch_rss_data(urls)

if __name__ == "__main__":
    main()